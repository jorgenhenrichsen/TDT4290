
{% extends 'base.html' %}

{% block head %}
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" media="all" />
        <link rel="stylesheet" type="text/css" href="/static/css/search.css">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript">
        </script> <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
        <script src="/static/js/jquery.tablesorter.js" type="text/javascript"></script>

        <script type="text/javascript">


        $(document).ready(function () {
           $("#result-table").tablesorter({
               cancelSelection:true,
           });
        });

        var selectedLifter;
        var selectedClub;

        /*
         * Autocomplete function for the name text-input-field.
         */
        $(function() {
          $("#query-lifter").autocomplete({
              source: "/search/lifter/",
              minLength: 2,
              select: function (event, ui) {
                  var id = ui.item.id;
                  console.log("Selected " + ui.item.label, "ID: " + id);
                  selectedLifter = id;
              }
          });
        });

        /*
         * Autocomplete function for the club text-input-field.
         */
        $(function () {
            $("#query-club").autocomplete({
                source: "/search/club/",
                minLength: 1,
                select: function (event, ui) {
                    var id = ui.item.id;
                    console.log("Selected " + ui.item.label, "ID: " + id);
                    selectedClub = id;
                }
            });
        });

        /*
         * Custom form-submit function to supply ids for selected items.
         */
        function submitForm() {
            var form = document.getElementById("search-form");

            var lifterId = document.getElementById("lifter-id");
            lifterId.value = selectedLifter;

            var clubId = document.getElementById("club-id");
            clubId.value = selectedClub;

            form.submit();
        }

        </script>
{%  endblock %}


{% block content %}

    <section class="search-section">

        <h1>Søk etter resultater</h1>

        <form class="query-form" id="search-form" role="search" action="/search/">
            <div class="ui-widget">
                <input type="text" id="query-lifter" class="query-text-input" placeholder="Navn...">
                <input type="text" id="query-club" class="query-text-input" placeholder="Klubb...">

                <input type="hidden" value="" id="lifter-id" name="lifter_id">
                <input type="hidden" value="" id="club-id" name="club_id">

            </div>
         </form>

        <button class="search-button" onclick="submitForm()">Søk</button>

    </section>


    <section class="search-results-section">
            <table class="tablesorter" id="result-table">
                <thead>

                    <tr>
                        <th>Utøver</th>
                        <th>Klubb</th>
                        <th>Kategori</th>
                        <th>Arrangør</th>
                        <th>Rykk</th>
                        <th>Støt</th>
                        <th>Total</th>
                        <th>Poeng</th>
                        <th>Veteranpoeng</th>
                    </tr>

                </thead>


                {% for result in results %}

                <tr class="result-element">

                    <th>{{ result.lifter.first_name }} {{ result.lifter.last_name }}</th>
                    <th>{{ result.lifter.club }}</th>
                    <th>Kategori</th>
                    <th>Arrangør</th>
                    <th>{{ result.get_best_snatch }}</th>
                    <th>{{ result.get_bets_clean_and_jerk }}</th>
                    <th>{{ result.total }}</th>
                    <th>{{ result.points }}</th>
                    <th>{{ result.points_veteran }}</th>

                </tr>

                {%  empty %}
                    <tr>Ingen resultater for ditt søk.</tr>
                {% endfor %}

            </table>


        </section>

{% endblock %}